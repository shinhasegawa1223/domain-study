# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¯”è¼ƒ

DDDï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆï¼‰ã®å®Ÿè·µã«ãŠã„ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä¸­å¿ƒæ®ãˆã€æŠ€è¡“çš„ãªè©³ç´°ã‹ã‚‰éš”é›¢ã™ã‚‹ãŸã‚ã«æ§˜ã€…ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒåˆ©ç”¨ã•ã‚Œã¾ã™ã€‚
ã“ã“ã§ã¯ä»£è¡¨çš„ãª4ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦è§£èª¬ã—ã€ãã‚Œã‚‰ã®å…±é€šç‚¹ã¨é•ã„ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚

## ç›®æ¬¡

1. [ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Layered Architecture)](#1-ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£-layered-architecture)
2. [ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Hexagonal Architecture)](#2-ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£-hexagonal-architecture)
3. [ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Onion Architecture)](#3-ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£-onion-architecture)
4. [ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Clean Architecture)](#4-ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£-clean-architecture)
5. [æ¯”è¼ƒã¨ã¾ã¨ã‚](#5-æ¯”è¼ƒã¨ã¾ã¨ã‚)

---

> ğŸ“ **å›³è§£**: [Excalidrawã§è¦‹ã‚‹](../other/13_architectural_patterns/architectures.excalidraw)

![ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¯”è¼ƒ](../pic/13_architectural_patterns/architectures.png)

---

## 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Layered Architecture)

æœ€ã‚‚å¤ãã‹ã‚‰ã‚ã‚‹ä¼çµ±çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ãŒã€DDDã«ãŠã„ã¦ã¯ã€Œä¾å­˜é–¢ä¿‚é€†è»¢ã®åŸå‰‡ (DIP)ã€ã‚’é©ç”¨ã—ãŸå½¢ãŒä¸€èˆ¬çš„ã§ã™ã€‚

### æ§‹é€ 

ä¼çµ±çš„ã«ã¯ä»¥ä¸‹ã®4å±¤ã§æ§‹æˆã•ã‚Œã¾ã™ãŒã€DIPé©ç”¨å¾Œã¯ä¾å­˜ã®æ–¹å‘ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚

| å±¤ | è²¬å‹™ | ä¾‹ |
|---|---|---|
| **ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ã‚„ã‚Šå–ã‚Š | Controller, View, API Endpoint |
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤** | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®èª¿æ•´å½¹ | ApplicationService, Command Handler |
| **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ | Entity, Value Object, Domain Service |
| **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤** | æŠ€è¡“çš„è©³ç´° | Repositoryå®Ÿè£…, ORM, ãƒ¡ãƒ¼ãƒ«é€ä¿¡ |

### ä¾å­˜ã®æ–¹å‘ (DIPé©ç”¨å¾Œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                       â”‚
â”‚    (Controller ãŒ ApplicationService ã‚’å‘¼ã³å‡ºã™)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Application Layer                        â”‚
â”‚    (IRepository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ã†)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Domain Layer                           â”‚
â”‚    (IRepository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚  DIP (ä¾å­˜é–¢ä¿‚é€†è»¢)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                       â”‚
â”‚    (IRepository ã‚’å®Ÿè£…)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ¼ãƒ‰ä¾‹

```typescript
// ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
interface IOrderRepository {
  findById(id: OrderId): Promise<Order | null>;
  save(order: Order): Promise<void>;
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
class PlaceOrderUseCase {
  constructor(private orderRepository: IOrderRepository) {}
  
  async execute(command: PlaceOrderCommand): Promise<void> {
    const order = Order.create(command.customerId, command.items);
    await this.orderRepository.save(order);
  }
}

// ã‚¤ãƒ³ãƒ•ãƒ©å±¤: ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
class PostgresOrderRepository implements IOrderRepository {
  async save(order: Order): Promise<void> {
    // PostgreSQLå›ºæœ‰ã®å®Ÿè£…
  }
}
```

### ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

| ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|---------|-----------|
| ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„ | å±¤é–“ã®å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚ŠãŒã¡ |
| åºƒãæ™®åŠã—ã¦ã„ã‚‹ | ã€Œä¸Šã‹ã‚‰ä¸‹ã€ã¸ã®ä¾å­˜ã«é™¥ã‚Šã‚„ã™ã„ |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã®è¦ªå’Œæ€§ãŒé«˜ã„ | ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã¸ã®ä¾å­˜ãŒç™ºç”Ÿã—ã‚„ã™ã„ |

### ã‚ˆãã‚ã‚‹é–“é•ã„

| âŒ ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ | âœ… æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ |
|------------------|----------------|
| ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ãŒDBã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ | RepositoryçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ |
| Controllerå†…ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ | Domain/Applicationã«ç§»å‹• |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãã®ã¾ã¾APIè¿”å´ | DTOã«å¤‰æ›ã—ã¦è¿”å´ |

---

## 2. ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Hexagonal Architecture)

åˆ¥åã€Œãƒãƒ¼ãƒˆã‚¢ãƒ³ãƒ‰ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (Ports and Adapters)ã€ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Œå†…å´ã€ã¨ã€Œå¤–å´ã€ã«æ˜ç¢ºã«åˆ†ã‘ã€ãã®å¢ƒç•Œã‚’ã€Œãƒãƒ¼ãƒˆã€ã¨ã€Œã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã€ã§ç¹‹ãã¨ã„ã†è€ƒãˆæ–¹ã§ã™ã€‚

> ğŸ’¡ **ãªãœå…­è§’å½¢ãªã®ã‹ï¼Ÿ**
> Alistair Cockburn ãŒæå”±ã—ãŸéš›ã€ã€Œå¤šãã®ãƒãƒ¼ãƒˆã‚’æŒã¤ã€ã“ã¨ã‚’è¦–è¦šçš„ã«è¡¨ç¾ã™ã‚‹ãŸã‚ã«å…­è§’å½¢ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚å®Ÿéš›ã«ã¯è¾ºã®æ•°ã«æ„å‘³ã¯ãªãã€4ã¤ã§ã‚‚8ã¤ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

### æ§‹é€ 

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ | ä¾‹ |
|---------------|------|---|
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¢** | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ + ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ | Entity, UseCase |
| **å…¥åŠ›ãƒãƒ¼ãƒˆ (Driving Port)** | å¤–éƒ¨ã‹ã‚‰ã‚³ã‚¢ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `IPlaceOrderUseCase` |
| **å‡ºåŠ›ãƒãƒ¼ãƒˆ (Driven Port)** | ã‚³ã‚¢ãŒå¤–éƒ¨ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `IOrderRepository` |
| **å…¥åŠ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (Driving Adapter)** | å…¥åŠ›ãƒãƒ¼ãƒˆã‚’å‘¼ã³å‡ºã™å®Ÿè£… | REST Controller, CLI |
| **å‡ºåŠ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (Driven Adapter)** | å‡ºåŠ›ãƒãƒ¼ãƒˆã‚’å®Ÿè£… | MySQLRepository |

### Driving ã¨ Driven ã®é•ã„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚    [Driving Adapter]            [Driven Adapter]                â”‚
â”‚        â†“                              â†‘                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚   UI    â”‚ â”€â”€â†’ Port â”€â”€â†’ â”‚  Core  â”‚ â”€â”€â†’ Port â”€â”€â†’ â”‚   DB    â”‚  â”‚
â”‚   â”‚  Test   â”‚              â”‚        â”‚              â”‚  API   â”‚   â”‚
â”‚   â”‚   CLI   â”‚              â”‚        â”‚              â”‚  MQ    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   ã€Œã‚³ã‚¢ã‚’é§†å‹•ã™ã‚‹ã€        ã€Œã‚³ã‚¢ã«é§†å‹•ã•ã‚Œã‚‹ã€                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Driving (Primary)**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Œå‘¼ã³å‡ºã™å´ã€ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã€ãƒ†ã‚¹ãƒˆã€ãƒãƒƒãƒå‡¦ç†ãªã©ã€‚
- **Driven (Secondary)**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã€Œå‘¼ã³å‡ºã•ã‚Œã‚‹å´ã€ã€‚DBã€å¤–éƒ¨APIã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ãªã©ã€‚

### ã‚³ãƒ¼ãƒ‰ä¾‹

```typescript
// === ãƒãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰===

// å…¥åŠ›ãƒãƒ¼ãƒˆ (Driving Port) - ã‚³ã‚¢ãŒå…¬é–‹ã™ã‚‹ã‚‚ã®
interface IPlaceOrderUseCase {
  execute(command: PlaceOrderCommand): Promise<OrderId>;
}

// å‡ºåŠ›ãƒãƒ¼ãƒˆ (Driven Port) - ã‚³ã‚¢ãŒä¾å­˜ã™ã‚‹ã‚‚ã®
interface IOrderRepository {
  save(order: Order): Promise<void>;
}
interface IPaymentGateway {
  charge(amount: Money, customerId: CustomerId): Promise<PaymentResult>;
}

// === ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¢ ===
class PlaceOrderUseCase implements IPlaceOrderUseCase {
  constructor(
    private orderRepository: IOrderRepository,
    private paymentGateway: IPaymentGateway
  ) {}

  async execute(command: PlaceOrderCommand): Promise<OrderId> {
    const order = Order.create(command);
    await this.paymentGateway.charge(order.totalAmount, command.customerId);
    await this.orderRepository.save(order);
    return order.id;
  }
}

// === ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ ===

// å…¥åŠ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (Driving Adapter)
class OrderController {
  constructor(private placeOrderUseCase: IPlaceOrderUseCase) {}
  
  async post(req: Request): Promise<Response> {
    const orderId = await this.placeOrderUseCase.execute(req.body);
    return Response.created({ orderId });
  }
}

// å‡ºåŠ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (Driven Adapter)
class StripePaymentGateway implements IPaymentGateway {
  async charge(amount: Money, customerId: CustomerId): Promise<PaymentResult> {
    // Stripe APIã‚’å‘¼ã³å‡ºã™
  }
}
```

### ãƒ¡ãƒªãƒƒãƒˆ

| ãƒ¡ãƒªãƒƒãƒˆ | èª¬æ˜ |
|---------|------|
| **å¯¾ç§°æ€§** | UI ã‚‚ DB ã‚‚ç­‰ã—ãã€Œå¤–éƒ¨ã€ã¨ã—ã¦æ‰±ã† |
| **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§** | ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆå¯èƒ½ |
| **æŠ€è¡“é¸æŠã®è‡ªç”±** | ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’å¤‰ãˆã‚‹ã ã‘ã§DBã‚„UIã‚’å¤‰æ›´å¯èƒ½ |
| **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ç´”ç²‹æ€§** | ã‚³ã‚¢ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„ |

---

## 3. ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Onion Architecture)

ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ã•ã‚‰ã«æ´—ç·´ã•ã›ã€åŒå¿ƒå††çŠ¶ã®å±¤æ§‹é€ ã§ä¾å­˜é–¢ä¿‚ã®æ–¹å‘ã‚’å³å¯†ã«å®šç¾©ã—ãŸã‚‚ã®ã§ã™ã€‚Jeffrey Palermo ã«ã‚ˆã£ã¦2008å¹´ã«æå”±ã•ã‚Œã¾ã—ãŸã€‚

### æ§‹é€ 

```
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         Infrastructure / UI             â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚  â”‚      Application Services        â”‚  â”‚
            â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
            â”‚  â”‚  â”‚     Domain Services       â”‚   â”‚  â”‚
            â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
            â”‚  â”‚  â”‚  â”‚   Domain Model     â”‚   â”‚   â”‚  â”‚
            â”‚  â”‚  â”‚  â”‚ (Entity / VO)      â”‚   â”‚   â”‚  â”‚
            â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
            â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          ä¾å­˜ã¯å¸¸ã«å†…å´ã¸ â†’
```

| å±¤ | è²¬å‹™ | ä¾‹ |
|---|------|---|
| **Domain Model** | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ»å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | `Order`, `Money`, `Email` |
| **Domain Services** | è¤‡æ•°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è·¨ããƒ­ã‚¸ãƒƒã‚¯ | `PricingService`, `OrderValidator` |
| **Application Services** | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | `PlaceOrderUseCase` |
| **Infrastructure/UI** | æŠ€è¡“çš„è©³ç´°ãƒ»å¤–éƒ¨æ¥ç‚¹ | Controller, Repositoryå®Ÿè£…, ORM |

### ä¾å­˜ã®ãƒ«ãƒ¼ãƒ«

> âš ï¸ **The Dependency Rule**  
> å¤–å´ã®å±¤ã¯å†…å´ã®å±¤ã«ä¾å­˜ã§ãã‚‹ãŒã€å†…å´ã®å±¤ã¯å¤–å´ã®å±¤ã®ã“ã¨ã‚’ä¸€åˆ‡çŸ¥ã‚‰ãªã„ã€‚

```typescript
// âœ… OK: Applicationå±¤ â†’ Domainå±¤
class PlaceOrderUseCase {
  constructor(private order: Order) {} // Orderã¯Domainå±¤
}

// âŒ NG: Domainå±¤ â†’ Infrastructureå±¤
class Order {
  constructor(private dbConnection: Database) {} // çµ¶å¯¾ãƒ€ãƒ¡ï¼
}
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®é•ã„

| è¦³ç‚¹ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ | ã‚ªãƒ‹ã‚ªãƒ³ |
|------|-----------|---------|
| ä¾å­˜ã®æ–¹å‘ | ä¸Šâ†’ä¸‹ | å¤–â†’å†… |
| ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ä½ç½® | æœ€ä¸‹å±¤ | æœ€å¤–å±¤ |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ‰±ã„ | ä¸­é–“å±¤ã®ä¸€ã¤ | æœ€ä¸­å¿ƒï¼ˆæœ€é‡è¦ï¼‰ |

---

## 4. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Clean Architecture)

ã“ã‚Œã¾ã§ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é›†å¤§æˆã¨ã—ã¦ã€Robert C. Martin (Uncle Bob) ã«ã‚ˆã£ã¦2012å¹´ã«æå”±ã•ã‚Œã¾ã—ãŸã€‚æ¦‚å¿µçš„ã«ã¯ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨éå¸¸ã«ä¼¼ã¦ã„ã¾ã™ã€‚

### æ§‹é€ 

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             Frameworks & Drivers (é’)            â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
        â”‚    â”‚       Interface Adapters (ç·‘)        â”‚     â”‚
        â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚
        â”‚    â”‚   â”‚        Use Cases (èµ¤)        â”‚   â”‚     â”‚
        â”‚    â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚     â”‚
        â”‚    â”‚   â”‚   â”‚    Entities (é»„)     â”‚   â”‚   â”‚     â”‚
        â”‚    â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚     â”‚
        â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å±¤ | è²¬å‹™ | DDDã¨ã®å¯¾å¿œ |
|---|------|------------|
| **Entities** | ä¼æ¥­å…¨ä½“ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« | Domain Model |
| **Use Cases** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« | Application Service |
| **Interface Adapters** | ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ»å½¢å¼å¤‰æ› | Controller, Presenter, Gateway |
| **Frameworks & Drivers** | æŠ€è¡“çš„è©³ç´° | Web Framework, ORM, DB |

### ä¾å­˜é–¢ä¿‚ã®ãƒ«ãƒ¼ãƒ« (The Dependency Rule)

> ğŸ’¡ **Uncle Bobã®è¨€è‘‰**  
> ã€Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä¾å­˜æ€§ã¯ã€å¸¸ã«å†…å´ï¼ˆé«˜ãƒ¬ãƒ™ãƒ«ãªæ–¹é‡ï¼‰ã«å‘ã‹ã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€

### Input/Output Boundary ãƒ‘ã‚¿ãƒ¼ãƒ³

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´çš„ãªæ¦‚å¿µã¨ã—ã¦ã€**Boundaryï¼ˆå¢ƒç•Œï¼‰** ãŒã‚ã‚Šã¾ã™ã€‚

```typescript
// Input Boundary (Use Case Input Port)
interface IPlaceOrderInputBoundary {
  execute(request: PlaceOrderRequest): void;
}

// Output Boundary (Use Case Output Port)
interface IPlaceOrderOutputBoundary {
  present(response: PlaceOrderResponse): void;
}

// Use Caseå®Ÿè£…
class PlaceOrderInteractor implements IPlaceOrderInputBoundary {
  constructor(
    private orderRepository: IOrderRepository,
    private presenter: IPlaceOrderOutputBoundary
  ) {}

  execute(request: PlaceOrderRequest): void {
    const order = Order.create(request);
    this.orderRepository.save(order);
    this.presenter.present(new PlaceOrderResponse(order.id));
  }
}

// Presenter (Interface Adapterå±¤)
class PlaceOrderPresenter implements IPlaceOrderOutputBoundary {
  present(response: PlaceOrderResponse): void {
    // ViewModelã«å¤‰æ›ã—ã¦UIã«æ¸¡ã™
  }
}
```

### ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã®é•ã„

| è¦³ç‚¹ | ã‚ªãƒ‹ã‚ªãƒ³ | ã‚¯ãƒªãƒ¼ãƒ³ |
|------|---------|---------|
| æå”±è€… | Jeffrey Palermo | Robert C. Martin |
| Presenterã®ä½ç½® | æ˜ç¢ºã§ãªã„ | Interface Adapterså±¤ã¨ã—ã¦æ˜ç¢º |
| Interactor | Application Services | Use Casesã¨ã—ã¦å¼·èª¿ |
| å®Ÿè³ªçš„ãªé•ã„ | ã»ã¼åŒã˜æ¦‚å¿µã§ã€è¡¨ç¾ãŒç•°ãªã‚‹ã ã‘ |

---

## 5. æ¯”è¼ƒã¨ã¾ã¨ã‚

ã“ã‚Œã‚‰4ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€è¡¨ç¾æ–¹æ³•ã¯ç•°ãªã‚Šã¾ã™ãŒã€**ç›®æŒ‡ã—ã¦ã„ã‚‹ã‚´ãƒ¼ãƒ«ã¯åŒã˜**ã§ã™ã€‚

### å…±é€šã™ã‚‹ç›®çš„

1.  **é–¢å¿ƒäº‹ã®åˆ†é›¢**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨æŠ€è¡“çš„è©³ç´°ï¼ˆUI, DB, Frameworkï¼‰ã‚’åˆ‡ã‚Šé›¢ã™ã€‚
2.  **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½ã«ã™ã‚‹ã€‚
3.  **ç‹¬ç«‹æ€§**: UIã‚„DBã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤‰æ›´ã—ã¦ã‚‚ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã€‚

### ç”¨èªã®å¯¾å¿œè¡¨

| æ¦‚å¿µ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ | ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ« | ã‚ªãƒ‹ã‚ªãƒ³ | ã‚¯ãƒªãƒ¼ãƒ³ |
| :--- | :--- | :--- | :--- | :--- |
| **ãƒ“ã‚¸ãƒã‚¹ã®ä¸­å¿ƒ** | ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ | Inside (App Core) | Domain Model | Entities |
| **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ | Inside (App Core) | Application Services | Use Cases |
| **æŠ€è¡“çš„è©³ç´°** | ã‚¤ãƒ³ãƒ•ãƒ©å±¤ / UIå±¤ | Outside (Adapter) | Infrastructure / UI | Frameworks & Drivers |
| **å¢ƒç•Œã®å®šç¾©** | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (DIP) | Port | Interface | Input/Output Boundary |

### ã©ã‚Œã‚’æ¡ç”¨ã™ã¹ãã‹ï¼Ÿ

DDDã‚’å®Ÿè·µã™ã‚‹å ´åˆã€**ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** ã¾ãŸã¯ **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** ã®è€ƒãˆæ–¹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚
ç‰¹ã«ã€Œä¾å­˜ã®æ–¹å‘ã‚’å†…å´ã«å‘ã‘ã‚‹ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã•ãˆå®ˆã‚Œã¦ã„ã‚Œã°ã€å±¤ã®å³å¯†ãªåå‰ã‚ˆã‚Šã‚‚ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å®ˆã‚‹ã“ã¨**ãŒæœ€é‡è¦ã§ã™ã€‚
